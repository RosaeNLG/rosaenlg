<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- vue -->
    <script src="../../../_/js/vendor/vue.min.js"></script>

    <!-- codemirror -->
    <script src="../../../_/js/vendor/codemirror.js"></script>
    <script src="../../../_/js/vendor/vue-codemirror.js"></script>
    <script src="../../../_/js/vendor/pug.js"></script>
    <script src="../../../_/js/vendor/javascript.js"></script>

    <!-- editor -->
    <script src="../../../_/js/vendor/editor-3.1.1.js"></script>


    <title>RosaeNLG node.js Server :: RosaeNLG // Docs</title>
    <link rel="canonical" href="https://rosaenlg.github.io/rosaenlg/rosaenlg/4.2.0/integration/node-server.html">
    <meta name="generator" content="Antora 3.1.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
<meta name="docsearch:version" content="3.1.1" />

    <!-- prevent favicon request -->
    <link rel="icon" href="data:,">
    
    <link 
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@docsearch/css@alpha" />

  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">

    <div class="navbar-brand">
      <div class="navbar-item">
        <a class="navbar-item" href="https://rosaenlg.github.io/rosaenlg">RosaeNLG // Docs</a>
      </div>


      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>

    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Project</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://github.com/RosaeNLG/rosaenlg">Main Repository</a>
            <a class="navbar-item" href="https://github.com/RosaeNLG/rosaenlg/issues">Core Issue Traker</a>
            <a class="navbar-item" href="https://github.com/RosaeNLG">Related projects</a>
          </div>
        </div>
        <a class="navbar-item" href="https://rosaenlg.org/ide/index.html">Try now!</a>
      </div>
    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container" data-component="rosaenlg" data-version="3.1.1">
  <aside class="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">RosaeNLG</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../changelog.html">Changelog</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../quickstart.html">Quick Start</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../dev_experience.html">Developer experience</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../tutorials/intro.html">Tutorials and Examples</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tutorials/tutorial_en_US.html">English Tutorial</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tutorials/tutorial_fr_FR.html">French Tutorial (en Fran√ßais !)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tutorials/tutorial_de_DE.html">German Tutorial</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tutorials/example_fr_FR.html">French example</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tutorials/example_en_US.html">English example</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="integration.html">Integration, node.js, Java, Docker etc.</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="project_generator.html">RosaeNLG node.js project generator using Yeoman</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="rosaenlg_packager.html">Packaging templates</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="browser_intro.html">In the Browser</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="browser_rendering.html">Rendering</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="browser_compiling.html">Compiling</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="browser_ide.html">Browser IDE</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <span class="nav-text">Command Line Interface</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="rosaenlg-cli.html">CLI module</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="docker-cli.html">Docker image for CLI</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="node-server.html">Node.js Server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="lambda.html">AWS Lambda</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <span class="nav-text">Java Wrapper and Server</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="java-wrapper.html">Java Wrapper</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="java-server.html">Java Server and Docker Server</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="testing.html">Testing with mocha and mochawesome</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <span class="nav-text">Misc</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="rosaenlg-no-pug.html">Usage without templates</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="observable.html">Integration in Observable HQ</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../mixins_ref/intro.html">Reference Documentation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../mixins_ref/value.html">Value</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../mixins_ref/value_numbers.html">Numbers</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../mixins_ref/value_dates.html">Dates</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../mixins_ref/value_nominal_groups.html">Nominal Groups</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../mixins_ref/value_simplified_syntax.html">Simplified Syntax</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../mixins_ref/referring_expression.html">Referring Expressions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../mixins_ref/adjectives.html">Adjectives</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../mixins_ref/eachz_itemz.html">Eachz and Itemz</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../mixins_ref/synonyms.html">Synonyms</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../mixins_ref/verbs.html">Verbs</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../mixins_ref/verbs_english.html">English</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../mixins_ref/verbs_french.html">French</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../mixins_ref/verbs_german.html">German</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../mixins_ref/verbs_italian.html">Italian</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../mixins_ref/verbs_spanish.html">Spanish</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../mixins_ref/possessives.html">Possessives</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../mixins_ref/recordSaid.html">hasSaid / recordSaid</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../mixins_ref/filter.html">Filter</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../mixins_ref/dict.html">Dictionnary</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../mixins_ref/otherAndHelpers.html">Other and Helpers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../mixins_ref/debugging.html">Debugging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../mixins_ref/multilingual.html">Multilingual Templates</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../mixins_ref/node_js_versions.html">Node.js compatibility</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../libs/libs.html">Libraries</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../libs/countries.html">Countries</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">About NLG and RosaeNLG</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../about/nlg.html">What is NLG?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../about/advanced_nlg_examples.html">Advanced examples of NLG features</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../about/usecases.html">NLG usecases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../about/about.html">About RosaeNLG, the Author</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../about/support.html">Support, Hosting, Services</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../about/features.html">Main Features</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../about/compare.html">Compare with CoreNLG and xSpin</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Advanced</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../advanced/other_languages.html">Other Languages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../advanced/yseop.html">Yseop Template Generator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../advanced/performance.html">Performance</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../advanced/related_projects.html">Related Projects</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../advanced/params.html">Global Parameters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../advanced/howitworks.html">How it works</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../advanced/pug.html">Why Pug?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../advanced/random.html">Random Numbers (and why it matters)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../advanced/filter.html">Filter mechanism</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../advanced/resources.html">Linguistic resources</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../advanced/logo.html">Logo</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">RosaeNLG</span>
    <span class="version">3.1.1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">RosaeNLG</span>
      <ul class="versions">
        <li class="version">
          <a href="../../4.2.0/index.html">4.2.0</a>
        </li>
        <li class="version">
          <a href="../../4.1.0/index.html">4.1.0</a>
        </li>
        <li class="version">
          <a href="../../4.0.0/index.html">4.0.0</a>
        </li>
        <li class="version">
          <a href="../../3.4.0/index.html">3.4.0</a>
        </li>
        <li class="version">
          <a href="../../3.3.1/index.html">3.3.1</a>
        </li>
        <li class="version">
          <a href="../../3.3.0/index.html">3.3.0</a>
        </li>
        <li class="version">
          <a href="../../3.2.6/index.html">3.2.6</a>
        </li>
        <li class="version">
          <a href="../../3.2.5/index.html">3.2.5</a>
        </li>
        <li class="version">
          <a href="../../3.2.4/index.html">3.2.4</a>
        </li>
        <li class="version">
          <a href="../../3.2.3/index.html">3.2.3</a>
        </li>
        <li class="version">
          <a href="../../3.2.2/index.html">3.2.2</a>
        </li>
        <li class="version">
          <a href="../../3.2.1/index.html">3.2.1</a>
        </li>
        <li class="version">
          <a href="../../3.2.0/index.html">3.2.0</a>
        </li>
        <li class="version">
          <a href="../../3.1.2/index.html">3.1.2</a>
        </li>
        <li class="version is-current">
          <a href="../index.html">3.1.1</a>
        </li>
        <li class="version">
          <a href="../../3.1.0/index.html">3.1.0</a>
        </li>
        <li class="version">
          <a href="../../3.0.4/index.html">3.0.4</a>
        </li>
        <li class="version">
          <a href="../../3.0.3/index.html">3.0.3</a>
        </li>
        <li class="version">
          <a href="../../3.0.2/index.html">3.0.2</a>
        </li>
        <li class="version">
          <a href="../../3.0.1/index.html">3.0.1</a>
        </li>
        <li class="version">
          <a href="../../3.0.0/index.html">3.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="../../4.2.0/index.html" class="home-link"></a>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="../index.html">RosaeNLG</a></li>
    <li class="crumb"><a href="integration.html">Integration, node.js, Java, Docker etc.</a></li>
    <li class="crumb"><a href="node-server.html">Node.js Server</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="versions-menu-toggle" title="Show other versions of page">3.1.1</button>
  <div class="versions-menu">
    <a class="version" href="../../4.2.0/integration/node-server.html">4.2.0</a>
    <a class="version" href="../../4.1.0/integration/node-server.html">4.1.0</a>
    <a class="version" href="../../4.0.0/integration/node-server.html">4.0.0</a>
    <a class="version" href="../../3.4.0/integration/node-server.html">3.4.0</a>
    <a class="version" href="../../3.3.1/integration/node-server.html">3.3.1</a>
    <a class="version" href="../../3.3.0/integration/node-server.html">3.3.0</a>
    <a class="version" href="../../3.2.6/integration/node-server.html">3.2.6</a>
    <a class="version" href="../../3.2.5/integration/node-server.html">3.2.5</a>
    <a class="version" href="../../3.2.4/integration/node-server.html">3.2.4</a>
    <a class="version" href="../../3.2.3/integration/node-server.html">3.2.3</a>
    <a class="version" href="../../3.2.2/integration/node-server.html">3.2.2</a>
    <a class="version" href="../../3.2.1/integration/node-server.html">3.2.1</a>
    <a class="version" href="../../3.2.0/integration/node-server.html">3.2.0</a>
    <a class="version" href="../../3.1.2/integration/node-server.html">3.1.2</a>
    <a class="version is-current" href="node-server.html">3.1.1</a>
    <a class="version" href="../../3.1.0/integration/node-server.html">3.1.0</a>
    <a class="version" href="../../3.0.4/integration/node-server.html">3.0.4</a>
    <a class="version" href="../../3.0.3/integration/node-server.html">3.0.3</a>
    <a class="version" href="../../3.0.2/integration/node-server.html">3.0.2</a>
    <a class="version" href="../../3.0.1/integration/node-server.html">3.0.1</a>
    <a class="version" href="../../3.0.0/integration/node-server.html">3.0.0</a>
  </div>
</div>
</div>
<article class="doc">

<h1>RosaeNLG node.js Server</h1>
<div class="oldversion">
This is the documentation for 3.1.1 version, which is not the latest version. Consider upgrading to <a href="../../4.2.0/integration/node-server.html">4.2.0</a>.
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Server for <a href="https://rosaenlg.org">RosaeNLG</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_install_run_the_server"><a class="anchor" href="#_install_run_the_server"></a>Install &amp; Run the server</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_using_npm_and_node_js"><a class="anchor" href="#_using_npm_and_node_js"></a>Using npm and node.js</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir my-rosaenlg-server
cd my-rosaenlg-server
npm init --yes
npm install rosaenlg-node-server
npx rosaenlg-server</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_docker"><a class="anchor" href="#_using_docker"></a>Using Docker</h3>
<div class="paragraph">
<p>Not saving templates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker run -p 5000:5000 -i rosaenlg/server:latest</code></pre>
</div>
</div>
<div class="paragraph">
<p>Saving templates on the disk (here on an AWS EC2 server): you have to define the <code>ROSAENLG_HOMEDIR</code> variable and map volumes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir templates
docker run -p 80:5000 --env "ROSAENLG_HOMEDIR=/templates" -v /home/ec2-user/templates:/templates -i rosaenlg/server:latest</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use S3, see below.</p>
</div>
</div>
<div class="sect2">
<h3 id="_plain_exe_file"><a class="anchor" href="#_plain_exe_file"></a>Plain exe file</h3>
<div class="paragraph">
<p>You can easily generate a plain .exe file for the server using <a href="https://github.com/vercel/pkg">Vercel pkg</a>.</p>
</div>
<div class="paragraph">
<p>The .exe file is not shipped. To build it:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>install Vercel pkg: <code>npm install -g pkg</code></p>
</li>
<li>
<p>in the sources: go to <code>packages/rosaenlg-node-server</code>, and run <code>pkg package.json --targets node12-win-x64</code> (if you are on Windows)</p>
</li>
<li>
<p>run <code>rosaenlg-node-server.exe</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration"><a class="anchor" href="#_configuration"></a>Configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_port"><a class="anchor" href="#_port"></a>Port</h3>
<div class="paragraph">
<p>Set the port using environment variable <code>ROSAENLG_PORT</code>. Default is 5000.</p>
</div>
</div>
<div class="sect2">
<h3 id="_persistence"><a class="anchor" href="#_persistence"></a>Persistence</h3>
<div class="paragraph">
<p>By default, templates are not saved permanently: the server is empty when it starts, you can upload templates and render them, but they are lost when the server is shut down.
To save templates, you must provide a path to the disk or S3 credentials.
Templates will be saved when uploaded (as json files), and reloaded when the server restarts.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
when using <em>direct rendering</em>, which is rendering a template with both the template and the data in the same request, the template is cached but will never be stored permanently. This means that you can just use the server without configuring any persistence, and just using direct rendering.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Persistence on disk: Set the environment variable <code>ROSAENLG_HOMEDIR</code>.</p>
</li>
<li>
<p>Persistence on S3:</p>
<div class="ulist">
<ul>
<li>
<p>set the 3 environment variables <code>AWS_S3_BUCKET</code>, <code>AWS_S3_ACCESS_KEY_ID</code> and <code>AWS_S3_SECRET_ACCESS_KEY</code></p>
</li>
<li>
<p>optionally use <code>AWS_S3_ENDPOINT</code> to indicate an S3-compatible object storage service (for instance <code><a href="https://mys3service.com" class="bare">https://mys3service.com</a></code>)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
You can either save on disk or on S3, but not both.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also push new templates directly on the disk (using CI or whatever) and ask the server to reload them (see <code>reload</code> path), without having to restart the server. Follow these 2 constraints:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>filename must be <code>$user#$templateId.json</code>: you can use <code>DEFAULT_USER</code> (see <a href="#user_identification">User identification</a>)</p>
</li>
<li>
<p>a <code>user</code> field in the JSON (with the same value) must identify which user the template belongs to (for instance <code>DEFAULT_USER</code>)</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_security"><a class="anchor" href="#_security"></a>Security</h3>
<div class="paragraph">
<p>The server can be started without any security. This is relevant in a microservice architecture, when the server is not publicly visible, or for testing purposes. This is the default mode (or put environment variable <code>JWT_USE</code> to false).</p>
</div>
<div class="paragraph">
<p>For other scenarios JWT is available.</p>
</div>
<div class="paragraph">
<p>Run the server with the following environment variables set:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>JWT_USE</code> to true</p>
</li>
<li>
<p><code>JWT_JWKS_URI</code> points to JWKS URI, for instance <code><a href="https://xxxxx.auth0.com/.well-known/jwks.json" class="bare">https://xxxxx.auth0.com/.well-known/jwks.json</a></code> when using auth0</p>
</li>
<li>
<p><code>JWT_AUDIENCE</code>: audience</p>
</li>
<li>
<p><code>JWT_ISSUER</code>: issuer, for instance <code><a href="https://xxxxxx.eu.auth0.com/" class="bare">https://xxxxxx.eu.auth0.com/</a></code> when auth0</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When calling the API you first have to request a JWT token, and then put it in the header when calling the API: <code>Authorization: Bearer shhhhhhmysecret</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
health (<code>/health</code>) and swagger (<code>/api-docs</code>) routes are not protected even when activating JWT.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Testing was done using <a href="https://auth0.com/">auth0</a>, adaptations for other contexts can be required.</p>
</div>
</div>
<div class="sect2">
<h3 id="_share_templates"><a class="anchor" href="#_share_templates"></a>Share templates</h3>
<div class="paragraph">
<p>Shared templates are templates that can be rendered by anyone.</p>
</div>
<div class="paragraph">
<p>To activate the feature, you must set <code>ROSAENLG_SHARED_USER</code>: all the templates from this user can be rendered by anyone, but only their owner can get their content, update or delete it.</p>
</div>
<div class="paragraph">
<p>Additionally, when using the disk (with <code>ROSAENLG_HOMEDIR</code> set), you can set <code>ROSAENLG_SHARED_DIR</code>: this folder will contain the shared templates. Tey can be rendered by anyone, but no user can list them or modify them using the API (even the <code>ROSAENLG_SHARED_USER</code>). This is used when creating Docker images containing shared templates.</p>
</div>
</div>
<div class="sect2">
<h3 id="_log_using_cloudwatch"><a class="anchor" href="#_log_using_cloudwatch"></a>Log using CloudWatch</h3>
<div class="paragraph">
<p>You can put logs in CloudWatch (optional). This requires a bunch of environment variables:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AWS_CW_LOG_GROUP_NAME</code>: the log group name; must be created before</p>
</li>
<li>
<p><code>AWS_CW_LOG_STREAM_NAME</code>: the log stream name; must also exist</p>
</li>
<li>
<p><code>AWS_CW_ACCESS_KEY_ID</code>: access key ID</p>
</li>
<li>
<p><code>AWS_CW_SECRET_ACCESS_KEY</code>: secret access key</p>
</li>
<li>
<p><code>AWS_CW_REGION</code>: region</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
I had trouble creating the proper IAM policy, and finally used this:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
   "Version":"2012-10-17",
   "Statement":[
      {
      "Action": [
        "logs:CreateLogStream",
        "logs:DescribeLogStreams",
        "logs:PutLogEvents",
        "logs:GetLogEvents"
      ],
      "Effect": "Allow",
      "Resource": "arn:aws:logs:YOUR_REGION:YOUR_AWS_ID:log-group:YOUR_LOG_GROUP:*"
      }
   ]
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_in_a_cluster"><a class="anchor" href="#_in_a_cluster"></a>In a cluster</h3>
<div class="paragraph">
<p>When using the server in a cluster, you have the following issue: the templates are loaded in a specific instance (the one which received the create template request), but not on the other ones. Thus the other nodes must be able to load the template from the storage when they need it.</p>
</div>
<div class="paragraph">
<p>Recommanded configuration is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>use S3, not the disk persistence</p>
</li>
<li>
<p><code>ROSAENLG_LAZY_STARTUP</code>: usually put <code>true</code> (it defaults to <code>false</code>) so that the templates are not loaded when the server starts; they will get loaded once the servers needs them</p>
</li>
<li>
<p><code>ROSAENLG_FORGET_TEMPLATES</code>: put <code>true</code> (it defaults to <code>false</code>) so that a server can forget the templates after a while (they will just be reloaded if they are necessary again)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An alternative is to use no persistence backend, and just allow <code>direct render</code> requests.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_documentation_swagger_openapi"><a class="anchor" href="#_documentation_swagger_openapi"></a>Documentation, swagger, OpenAPI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Static version is <a href="https://rosaenlg.org/openapi/redoc-static_node.html">here</a>.</p>
</div>
<div class="paragraph">
<p>When running the server, the documentation is directly available: <a href="http://localhost:5000/api-docs" class="bare">http://localhost:5000/api-docs</a></p>
</div>
<div class="paragraph">
<p><a id="user_identification"></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_user_identification"><a class="anchor" href="#_user_identification"></a>User identification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each user has his own separate space: <code>user2</code> cannot see nor use <code>user1</code> templates, etc.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When using JWT, the user is uniquely identified using <code>sub</code> property in the token.</p>
</li>
<li>
<p>When not using JWT:</p>
<div class="ulist">
<ul>
<li>
<p>You put a user ID in a header; indicate the header name using <code>ROSAENLG_USER_ID_HEADER</code> env variable.</p>
</li>
<li>
<p>If you do not identify users (which is a valid choice), user will default to <code>DEFAULT_USER</code>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The name of the user cannot contain <code>\#</code> char.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_output_data_and_not_only_text"><a class="anchor" href="#_output_data_and_not_only_text"></a>Output data, and not only text</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The main feature is to output text in the <code>renderedText</code> field.
Sometimes, data is computed in the templates (in JavaScript files), and you might wish to output this data as well.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>in your template, use the <code>outputData</code> variable: <code>- outputData.obj = {aaa: 'bbb'};</code></p>
</li>
<li>
<p>in the API answer, read the <code>outputData</code> field, which will here contain <code>{"obj":{"aaa":"bbb"}</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_state_management"><a class="anchor" href="#_state_management"></a>State management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The API is stateless. It do not keep the result of a previous call.
When developing for instance a chatbot, you need to keep the state of the conversation somewhere outside the API.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_packaging_the_templates"><a class="anchor" href="#_packaging_the_templates"></a>Packaging the templates</h2>
<div class="sectionbody">
<div class="paragraph">
<p>RosaeNLG templates are typically developed on a node.js environment, as RosaeNLG is primarly a JavaScript library. Once the templates are developed, you can package them in a JSON package (instead of having multiple <code>.pug</code> files, which is not practical), deploy them on RosaeNLG Java Server and render texts.</p>
</div>
<div class="paragraph">
<p>To package the templates, use the <a href="rosaenlg_packager.html" class="xref page">RosaeNLG Packager</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_use_the_api_exemple_using_curl"><a class="anchor" href="#_use_the_api_exemple_using_curl"></a>Use the API - Exemple using cURL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Register a template</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -X PUT \
  http://localhost:5000/templates \
  -H 'Accept: */*' \
  -H 'Accept-Encoding: gzip, deflate' \
  -H 'Connection: keep-alive' \
  -H 'Content-Type: application/json' \
  -d '{
  "templateId": "chanson",
  "src": {
    "entryTemplate": "chanson.pug",
    "compileInfo": {
      "activate": false,
      "compileDebug": false,
      "language": "fr_FR"
    },
    "templates": {
      "chanson.pug": "p\n  | il #[+verb(getAnonMS(), {verb: '\''chanter'\'', tense:'\''FUTUR'\''} )]\n  | \"#{chanson.nom}\"\n  | de #{chanson.auteur}\n"
    }
  }
}
'</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should get:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "templateId":"chanson",
  "templateSha1":...,
  "ms":...}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the result <code>templateSha1</code> to customize the following request and render the template with some input data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -L -X POST \
  http://localhost:5000/templates/chanson/PUT_TEMPLATESHA1_HERE/render \
  -H 'Accept: */*' \
  -H 'Accept-Encoding: gzip, deflate' \
  -H 'Connection: keep-alive' \
  -H 'Content-Type: application/json' \
  -d '{
  "language": "fr_FR",
  "chanson": {
    "auteur": "√âdith Piaf",
    "nom": "Non, je ne regrette rien"
  }
}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should get:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "templateId":"chanson",
  "renderedText":"&lt;p&gt;Il chantera \"Non, je ne regrette rien\" d'√âdith Piaf&lt;/p&gt;",
  "renderOptions":{
    "language":"fr_FR"
  },
  "ms": ...
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can also ask <code>curl</code> to follow redirects, as, if the SHA1 is wrong, the server will automatically answer a 308 redirect. Use <code>curl -L -X POST &#8230;&#8203;</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_misc"><a class="anchor" href="#_misc"></a>Misc</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Do not</strong> use the Pug <code>cache</code> parameter, as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>anyway the <code>render</code> function of Pug is not used, so it is useless</p>
</li>
<li>
<p>the server already caches the compiled functions</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_versions"><a class="anchor" href="#_versions"></a>Versions</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">rosaenlg-node-server version</th>
<th class="tableblock halign-left valign-top">corresponding RosaeNLG version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALWAYS THE SAME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALWAYS THE SAME</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.5.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.5.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.4.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.4.1</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</article>
  </main>
</div>
<footer class="footer">
  <p>RosaeNLG is a Sandbox Project of <a href="https://lfaidata.foundation/">LF AI &amp; Data Foundation</a>. RosaeNLG is licenced under Apache 2.0, and its documentation under CC-BY-4.0. The documentation was built with Antora using a fork of the Antora default UI licensed under MPL-2.0.</p>
</footer><script src="../../../_/js/site.js"></script>
<script src="../../../_/js/vendor/highlight.js"></script>
<script>hljs.highlightAll()</script>

<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@alpha"></script>

<script type="text/javascript"> 
docsearch({
  container: '#docsearch',
  appId: 'OCFRXUBY1U',
  indexName: 'rosaenlg',
  apiKey: '27e9df5252425c18d4f37735143c134b',
  searchParameters:{
    facetFilters: [
      'version:3.1.1'
    ]
  }
});
</script>
  </body>
</html>
